<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplified Minds SSLC</title>

    <!-- Google Analytics Script -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q0HGP73J9J"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Q0HGP73J9J', {
            custom_map: {
                'dimension1': 'question_subject',
                'dimension2': 'question_type',
                'dimension3': 'mark_value',
                'dimension4': 'success_rate'
            }
        });

        gtag('set', {
            'question_subject': 'not_set',
            'question_type': 'not_set',
            'mark_value': 'not_set',
            'success_rate': 'not_set'
        });
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        .header-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 12px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .chapter-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
        }

        body {
            background-color: #f0fdf4;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
        }

        .timer-card {
            background: white;
            padding: 16px 24px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .timer-warning {
            background: #fee2e2;
            animation: pulse 1s infinite;
        }

        .timer-text {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .question-card {
            background: white;
            padding: 32px;
            border-radius: 24px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .question-number {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
        }

        .badge-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subject-badge {
            padding: 6px 16px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 14px;
        }

        .marks-badge {
            background: #f3f4f6;
            padding: 6px 16px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .question-content {
            font-size: 18px;
            color: #374151;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .sub-questions {
            margin-left: 24px;
            margin-top: 16px;
        }

        .sub-questions li {
            margin-bottom: 12px;
            color: #4b5563;
        }

        .mcq-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            font-size: 16px;
            color: #374151;
            font-weight: 500;
        }

        .option:hover:not(.selected):not(.correct):not(.incorrect) {
            border-color: #4338ca;
            background: #eef2ff;
        }

        .option.selected {
            border-color: #4338ca;
            background: #eef2ff;
        }

        .option.correct {
            border-color: #059669;
            background: #d1fae5;
        }

        .option.incorrect {
            border-color: #dc2626;
            background: #fee2e2;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .solution {
            margin-top: 24px;
            padding: 24px;
            border-radius: 16px;
            display: none;
        }

        .video-solution {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }

        .video-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            background: white;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .video-button:hover {
            background: #f9fafb;
            transform: translateY(-1px);
        }

        .video-icon {
            color: #ef4444;
        }

        .solution-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-weight: 600;
            color: #111827;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
        }

        .dots {
            display: flex;
            gap: 8px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #d1d5db;
            transition: all 0.3s ease;
        }

        .dot.active {
            background: #4338ca;
        }

        /* Subject-specific styles */
        .physics { background: #4338ca; color: white; }
        .chemistry { background: #dc2626; color: white; }
        .biology { background: #059669; color: white; }
        .maths { background: #d97706; color: white; }

        .light-physics { background: #e0e7ff; }
        .light-chemistry { background: #fee2e2; }
        .light-biology { background: #d1fae5; }
        .light-maths { background: #fef3c7; }

        .exam-year-badge {
            background: #f3f4f6;
            padding: 6px 16px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-left: 8px;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        @media (max-width: 640px) {
            body {
                padding: 16px;
            }

            .header-section {
                padding: 10px 16px;
            }
            
            .chapter-name {
                font-size: 1.1rem;
            }
            
            .logo {
                width: 32px;
                height: 32px;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .badge-container {
                flex-wrap: wrap;
            }

            .navigation {
                flex-direction: column;
                gap: 24px;
            }

            .dots {
                order: -1;
            }

            .mcq-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <div class="logo-container">
                <img src="SimplifiedMinds_App_icon.jpg" alt="Physics Logo" class="logo">
                <span class="chapter-name">Arithmetic Progression</span>
            </div>
        </div>

        <div class="timer-card">
            <div class="timer-text">
                ⏰ Time Left: <span id="time-display">1:00</span>
            </div>
        </div>

        <div class="question-card">
            <div class="question-header">
                <h2 class="question-number" id="question-number">Question 1</h2>
                <div class="badge-container">
                    <span id="subject-badge" class="subject-badge physics">Physics</span>
                    <span id="marks-badge" class="marks-badge">1 Mark</span>
                    <span id="exam-year-badge" class="marks-badge">June 2022</span>
                </div>
            </div>

            <div id="question-content" class="question-content">
                <!-- Question content will be dynamically inserted here -->
            </div>

            <button id="solution-btn" class="btn physics">
                <span>Show Solution</span>
            </button>

            <div id="solution-content" class="solution light-physics">
                <div class="solution-header">
                    📝 Solution
                </div>
                <div id="solution-text">
                    <!-- Solution content will be dynamically inserted here -->
                </div>
                <div class="video-solution">
                    <a id="video-link" href="#" target="_blank" class="video-button">
                        <span class="video-icon">▶</span>
                        Watch Video Solution
                    </a>
                </div>
            </div>
        </div>

        <div class="navigation">
            <button id="prev-btn" class="btn physics" disabled>← Previous</button>
            <div id="dots" class="dots">
                <span class="dot active"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
            <button id="next-btn" class="btn physics">Next →</button>
        </div>
    </div>

    <script>
// Quiz Questions
        const questions = [
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'Which of the following are in AP?',
                options: [
                    { id: 'a', text: '1, -1, -2', correct: false },
                    { id: 'b', text: '1, 5, 9', correct: true },
                    { id: 'c', text: '2, -2, 2, -2', correct: false },
                    { id: 'd', text: '1, 2, 4, 8', correct: false }
                ],
                examYear: 'July 2021',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Check common difference between consecutive terms<br>
* 1,-1,-2: d varies<br>
* 1,5,9: d = 4 (consistent) ✓<br>
* 2,-2,2,-2: not AP (repeating)<br>
* 1,2,4,8: d varies<br>
Therefore, option b) is correct.<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=933'
            },
{
                subject: 'maths',
                type: 'mcq_ap',
                question: 'Find the common difference of AP 8, 5, 2, -1...',
                options: [
                    { id: 'a', text: '-3', correct: true },
                    { id: 'b', text: '3', correct: false },
                    { id: 'c', text: '-5', correct: false },
                    { id: 'd', text: '5', correct: false }
                ],
                examYear: 'March 2022',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Take any two consecutive terms and subtract<br>
d = 5 - 8 = -3<br>
Therefore, common difference is -3<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=933'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'Find the common difference of AP 5, 3, 1, -1...',
                options: [
                    { id: 'a', text: '-2', correct: true },
                    { id: 'b', text: '2', correct: false },
                    { id: 'c', text: '-3', correct: false },
                    { id: 'd', text: '3', correct: false }
                ],
                examYear: 'June 2022',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Take any two consecutive terms and subtract<br>
d = 3 - 5 = -2<br>
Therefore, common difference is -2<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=933'
            },
{
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If nth term aₙ = 24-3n, find 2nd term',
                options: [
                    { id: 'a', text: '18', correct: true },
                    { id: 'b', text: '21', correct: false },
                    { id: 'c', text: '15', correct: false },
                    { id: 'd', text: '24', correct: false }
                ],
                examYear: 'March 2019',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Put n = 2<br>
a₂ = 24 - 3(2)<br>
   = 24 - 6<br>
   = 18<br>
Therefore, second term is 18<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1071'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If nth term aₙ = 5n+3, find 3rd term',
                options: [
                    { id: 'a', text: '15', correct: false },
                    { id: 'b', text: '18', correct: true },
                    { id: 'c', text: '21', correct: false },
                    { id: 'd', text: '24', correct: false }
                ],
                examYear: 'June 2019',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Put n = 3<br>
a₃ = 5(3) + 3<br>
   = 15 + 3<br>
   = 18<br>
Therefore, 3rd term is 18<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1071'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If nth term aₙ = 3n+6, find 8th term',
                options: [
                    { id: 'a', text: '24', correct: false },
                    { id: 'b', text: '27', correct: false },
                    { id: 'c', text: '30', correct: true },
                    { id: 'd', text: '33', correct: false }
                ],
                examYear: 'Prep 2020',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Put n = 8<br>
a₈ = 3(8) + 6<br>
   = 24 + 6<br>
   = 30<br>
Therefore, 8th term is 30<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1109'
            },
{
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If nth term aₙ = 3n-2, find 9th term',
                options: [
                    { id: 'a', text: '22', correct: false },
                    { id: 'b', text: '23', correct: false },
                    { id: 'c', text: '24', correct: false },
                    { id: 'd', text: '25', correct: true }
                ],
                examYear: 'Sept 2020',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Put n = 9<br>
a₉ = 3(9) - 2<br>
   = 27 - 2<br>
   = 25<br>
Therefore, 9th term is 25<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1266'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If nth term aₙ = 4n+5, find 5th term',
                options: [
                    { id: 'a', text: '21', correct: false },
                    { id: 'b', text: '23', correct: false },
                    { id: 'c', text: '25', correct: true },
                    { id: 'd', text: '27', correct: false }
                ],
                examYear: 'July 2021',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Put n = 5<br>
a₅ = 4(5) + 5<br>
   = 20 + 5<br>
   = 25<br>
Therefore, 5th term is 25<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1074'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If nth term aₙ = 2n+1, find common difference',
                options: [
                    { id: 'a', text: '1', correct: false },
                    { id: 'b', text: '3', correct: false },
                    { id: 'c', text: '2', correct: true },
                    { id: 'd', text: '4', correct: false }
                ],
                examYear: 'June 2021 & April 2020',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Find two consecutive terms and subtract<br>
a₂ = 2(2) + 1 = 5<br>
a₁ = 2(1) + 1 = 3<br>
d = a₂ - a₁ = 5 - 3 = 2<br>
Therefore, common difference is 2<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1191'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'Find 11th term of AP -3, -1, 1, 3, ...',
                options: [
                    { id: 'a', text: '15', correct: false },
                    { id: 'b', text: '16', correct: false },
                    { id: 'c', text: '18', correct: false },
                    { id: 'd', text: '17', correct: true }
                ],
                examYear: 'July 2021',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: First find d = -1-(-3) = 2<br>
Then use formula: a₁₁ = a₁ + 10d<br>
a₁₁ = -3 + 10(2)<br>
    = -3 + 20<br>
    = 17<br>
Therefore, 11th term is 17<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1323'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If sum of first 10 terms = 155 and first 9 terms = 126, find 10th term',
                options: [
                    { id: 'a', text: '27', correct: false },
                    { id: 'b', text: '28', correct: false },
                    { id: 'c', text: '29', correct: true },
                    { id: 'd', text: '30', correct: false }
                ],
                examYear: 'July 2021',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: 10th term = S₁₀ - S₉<br>
= 155 - 126<br>
= 29<br>
Therefore, 10th term is 29<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1458'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If 4, x, 10 are in AP, find x',
                options: [
                    { id: 'a', text: '5', correct: false },
                    { id: 'b', text: '6', correct: false },
                    { id: 'c', text: '8', correct: false },
                    { id: 'd', text: '7', correct: true }
                ],
                examYear: 'July 2021',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Middle term = average of first and last terms<br>
x = (4 + 10)/2<br>
  = 14/2<br>
  = 7<br>
Therefore, x = 7<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1711'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If aₙ = 2n+1, find (n-1)th term',
                options: [
                    { id: 'a', text: '2n+2', correct: false },
                    { id: 'b', text: '2n', correct: false },
                    { id: 'c', text: '2n-1', correct: true },
                    { id: 'd', text: '2n-2', correct: false }
                ],
                examYear: 'June 2023',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Replace n with (n-1)<br>
a(n-1) = 2(n-1) + 1<br>
       = 2n - 2 + 1<br>
       = 2n - 1<br>
Therefore, (n-1)th term is (2n-1)<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1186'
            },
            {
                subject: 'maths',
                type: 'mcq_ap',
                question: 'If 2, x, 26 are in AP, find x',
                options: [
                    { id: 'a', text: '12', correct: false },
                    { id: 'b', text: '14', correct: true },
                    { id: 'c', text: '16', correct: false },
                    { id: 'd', text: '18', correct: false }
                ],
                examYear: 'April 2024',
                marks: 1,
                timeAllowed: 60,
                solution: `Quick method: Middle term = average of first and last terms<br>
x = (2 + 26)/2<br>
  = 28/2<br>
  = 14<br>
Therefore, x = 14<br>
▶ Watch Video Solution`,
                videoUrl: 'https://youtu.be/qYBL3Cq8OHk?t=1711'
            }
        ];

        // Initialize variables
        let currentQuestionIndex = 0;
        let timeLeft = questions[0].timeAllowed;
        let timerInterval;
        let savedTimes = {};
        let questionStartTime;
        let mcqAttempts = {};

        // Initialize session ID for analytics
        const sessionId = Math.random().toString(36).substring(2, 15);

        // Get DOM elements
        const timeDisplay = document.getElementById('time-display');
        const questionNumber = document.getElementById('question-number');
        const subjectBadge = document.getElementById('subject-badge');
        const marksBadge = document.getElementById('marks-badge');
        const questionContent = document.getElementById('question-content');
        const solutionBtn = document.getElementById('solution-btn');
        const solutionContent = document.getElementById('solution-content');
        const solutionText = document.getElementById('solution-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const dots = document.getElementById('dots');
        const timer = document.querySelector('.timer-card');

        // Analytics tracking functions
        function trackQuestionStart(questionIndex) {
            const question = questions[questionIndex];
            questionStartTime = new Date();
            
            gtag('event', 'question_start', {
                question_subject: question.subject,
                question_type: question.type || 'regular',
                mark_value: question.marks,
                question_number: questionIndex + 1,
                session_id: sessionId
            });
        }

        function trackQuestionEnd(questionIndex, timeSpent) {
            const question = questions[questionIndex];
            const attempts = mcqAttempts[questionIndex] || 0;
            const successRate = question.type === 'mcq' ? 
                calculateMCQSuccessRate(questionIndex) : 'not_applicable';

            gtag('event', 'question_end', {
                question_subject: question.subject,
                question_type: question.type || 'regular',
                mark_value: question.marks,
                question_number: questionIndex + 1,
                time_spent_seconds: timeSpent,
                attempts: attempts,
                success_rate: successRate,
                session_id: sessionId
            });
        }

        function calculateMCQSuccessRate(questionIndex) {
            const attempts = mcqAttempts[questionIndex] || 0;
            if (attempts === 0) return 0;
            
            const correctAttempts = mcqAttempts[`${questionIndex}_correct`] || 0;
            return (correctAttempts / attempts * 100).toFixed(2);
        }

        function trackMCQSelection(questionIndex, selectedOption) {
            const question = questions[questionIndex];
            const isCorrect = question.options?.find(opt => opt.id === selectedOption)?.correct || false;
            
            mcqAttempts[questionIndex] = (mcqAttempts[questionIndex] || 0) + 1;
            if (isCorrect) {
                mcqAttempts[`${questionIndex}_correct`] = (mcqAttempts[`${questionIndex}_correct`] || 0) + 1;
            }

            gtag('event', 'mcq_selection', {
                question_subject: question.subject,
                question_type: 'mcq',
                mark_value: question.marks,
                question_number: questionIndex + 1,
                selected_option: selectedOption,
                is_correct: isCorrect,
                attempt_number: mcqAttempts[questionIndex],
                session_id: sessionId
            });
        }

        function trackSolutionView(questionIndex) {
            const question = questions[questionIndex];
            gtag('event', 'solution_view', {
                question_subject: question.subject,
                question_type: question.type || 'regular',
                mark_value: question.marks,
                question_number: questionIndex + 1,
                time_to_solution: Math.floor((new Date() - questionStartTime) / 1000),
                session_id: sessionId
            });
        }

        function trackTimeSpent() {
            const timeSpent = questions[currentQuestionIndex].timeAllowed - timeLeft;
            gtag('event', 'time_tracking', {
                question_subject: questions[currentQuestionIndex].subject,
                question_number: currentQuestionIndex + 1,
                time_spent_seconds: timeSpent,
                session_id: sessionId
            });
        }

        // Helper functions
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timeDisplay.textContent = formatTime(timeLeft);
                if (timeLeft <= 5) {
                    timer.classList.add('timer-warning');
                }
                if (timeLeft % 30 === 0) {
                    trackTimeSpent();
                }
            }
        }

        function updateQuestion() {
            if (typeof currentQuestionIndex !== 'undefined' && questionStartTime) {
                const timeSpent = Math.floor((new Date() - questionStartTime) / 1000);
                trackQuestionEnd(currentQuestionIndex, timeSpent);
            }

            const question = questions[currentQuestionIndex];
            
            questionNumber.textContent = `Question ${currentQuestionIndex + 1}`;
            
            ['physics', 'chemistry', 'biology', 'maths'].forEach(subject => {
                subjectBadge.classList.remove(subject);
                solutionBtn.classList.remove(subject);
                solutionContent.classList.remove(`light-${subject}`);
            });
            
            subjectBadge.classList.add(question.subject);
            solutionBtn.classList.add(question.subject);
            solutionContent.classList.add(`light-${question.subject}`);
            
            subjectBadge.textContent = question.subject.charAt(0).toUpperCase() + question.subject.slice(1);
            marksBadge.textContent = `${question.marks} ${question.marks === 1 ? 'Mark' : 'Marks'}`;
            document.getElementById('exam-year-badge').textContent = question.examYear;

            let content = `<p>${question.question}</p>`;
            
            if (question.type === 'mcq_ap' && question.options) {
                content += '<div class="mcq-options">';
                question.options.forEach(option => {
                    content += `
                        <div class="option" data-id="${option.id}">
                            ${option.id.toUpperCase()}. ${option.text}
                        </div>
                    `;
                });
                content += '</div>';
            } else if (question.subQuestions) {
                content += '<ol class="sub-questions">';
                question.subQuestions.forEach(sq => {
                    content += `<li>${sq}</li>`;
                });
                content += '</ol>';
            }
            
            questionContent.innerHTML = content;
            solutionText.innerHTML = question.solution;
            
            const videoLink = document.getElementById('video-link');
            if (question.videoUrl) {
                videoLink.href = question.videoUrl;
                videoLink.style.display = 'inline-flex';
            } else {
                videoLink.style.display = 'none';
            }

            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === questions.length - 1;
            
            ['physics', 'chemistry', 'biology', 'maths'].forEach(subject => {
                prevBtn.classList.remove(subject);
                nextBtn.classList.remove(subject);
            });
            prevBtn.classList.add(question.subject);
            nextBtn.classList.add(question.subject);

            dots.innerHTML = questions.map((_, index) => `
                <span class="dot ${index === currentQuestionIndex ? 'active' : ''}"></span>
            `).join('');

            solutionContent.style.display = 'none';
            solutionBtn.innerHTML = '<span>Show Solution</span>';

            clearInterval(timerInterval);
            timer.classList.remove('timer-warning');
            timeLeft = savedTimes[currentQuestionIndex] || question.timeAllowed;
            timeDisplay.textContent = formatTime(timeLeft);
            timerInterval = setInterval(updateTimer, 1000);

            trackQuestionStart(currentQuestionIndex);
        }

        // Event Listeners
        questionContent.addEventListener('click', (e) => {
            const optionElement = e.target.closest('.option');
            if (!optionElement) return;
            
            const question = questions[currentQuestionIndex];
            if (question.type !== 'mcq_ap') return;

            trackMCQSelection(currentQuestionIndex, optionElement.dataset.id);

            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            optionElement.classList.add('selected');
            
            if (solutionContent.style.display === 'block') {
                const selectedOptionId = optionElement.dataset.id;
                const correctOption = question.options.find(opt => opt.correct);
                
                document.querySelectorAll('.option').forEach(opt => {
                    const optionId = opt.dataset.id;
                    if (optionId === correctOption.id) {
                        opt.classList.add('correct');
                    } else if (optionId === selectedOptionId) {
                        opt.classList.add('incorrect');
                    }
                });
            }
        });

        solutionBtn.addEventListener('click', () => {
            const isShowing = solutionContent.style.display === 'block';
            
            if (!isShowing) {
                trackSolutionView(currentQuestionIndex);
            }
            
            solutionContent.style.display = isShowing ? 'none' : 'block';
            solutionBtn.innerHTML = isShowing ? '<span>Show Solution</span>' : '<span>Hide Solution</span>';

            const question = questions[currentQuestionIndex];
            if (question.type === 'mcq_ap') {
                const selectedOption = document.querySelector('.option.selected');
                const correctOption = question.options.find(opt => opt.correct);
                
                document.querySelectorAll('.option').forEach(opt => {
                    if (opt.dataset.id === correctOption.id) {
                        opt.classList.add('correct');
                    } else if (selectedOption && opt === selectedOption) {
                        opt.classList.add('incorrect');
                    }
                });
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                savedTimes[currentQuestionIndex] = timeLeft;
                const timeSpent = Math.floor((new Date() - questionStartTime) / 1000);
                trackQuestionEnd(currentQuestionIndex, timeSpent);
                currentQuestionIndex--;
                updateQuestion();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1) {
                savedTimes[currentQuestionIndex] = timeLeft;
                const timeSpent = Math.floor((new Date() - questionStartTime) / 1000);
                trackQuestionEnd(currentQuestionIndex, timeSpent);
                currentQuestionIndex++;
                updateQuestion();
            }
        });

        window.addEventListener('beforeunload', () => {
            if (typeof currentQuestionIndex !== 'undefined' && questionStartTime) {
                const timeSpent = Math.floor((new Date() - questionStartTime) / 1000);
                trackQuestionEnd(currentQuestionIndex, timeSpent);
            }
        });

        // Initialize the first question
        updateQuestion();
    </script>
</body>
</html>
